---
allowed-tools: [Read, Write, Bash]
description: Feature planning and design documentation system
---

# Design Planning Command

Structured approach to feature planning, design documentation, and architectural decision making.

## Context
- Project type: !`grep "projectType" .claude-setup.json 2>/dev/null | cut -d'"' -f4 || echo "unknown"`
- Architecture docs: !`find . -name "*ARCHITECTURE*" -o -name "*DESIGN*" -o -name "docs/*.md" | wc -l | xargs`+ files
- Design artifacts: !`find . -name "*.md" -path "./designs/*" -o -path "./.claude/designs/*" 2>/dev/null | wc -l | xargs`+ design files

## Your Task
Create comprehensive design documentation for features or architectural decisions. Handle different design scenarios:

```bash
#!/bin/bash

# Parse command arguments
COMMAND="${1:-interactive}"
shift
ARGS="$*"

# Ensure design directory exists
mkdir -p .claude/designs

case "$COMMAND" in
  "new"|"create"|"start")
    if [ -z "$ARGS" ]; then
      echo "‚ùå Please provide a feature or component name"
      echo "Usage: /design new <feature-name>"
      exit 1
    fi
    
    FEATURE_NAME="$ARGS"
    DESIGN_FILE=".claude/designs/${FEATURE_NAME}.md"
    
    if [ -f "$DESIGN_FILE" ]; then
      echo "‚ö†Ô∏è  Design document already exists: $DESIGN_FILE"
      echo "Use '/design edit $FEATURE_NAME' to modify it"
      exit 1
    fi
    
    echo "üìù Creating design document for: $FEATURE_NAME"
    
    cat > "$DESIGN_FILE" << EOF
# Design: $FEATURE_NAME

**Created**: $(date '+%Y-%m-%d')
**Status**: Draft
**Author**: $(git config user.name 2>/dev/null || echo "Unknown")

## Overview
Brief description of what this feature/component does and why it's needed.

## Problem Statement
What problem are we solving? What are the pain points with current approach?

## Requirements
### Functional Requirements
- [ ] Core functionality requirement 1
- [ ] Core functionality requirement 2

### Non-Functional Requirements
- [ ] Performance requirements
- [ ] Security requirements
- [ ] Scalability requirements
- [ ] Compatibility requirements

## Design Considerations
### Constraints
- Technical constraints
- Business constraints
- Time constraints

### Assumptions
- What assumptions are we making?

## Solution Design
### High-Level Architecture
Describe the overall approach and architecture.

### Component Breakdown
- **Component 1**: Purpose and responsibilities
- **Component 2**: Purpose and responsibilities

### Data Flow
Describe how data flows through the system.

### API Design (if applicable)
\`\`\`
// Example API endpoints or interfaces
\`\`\`

### Database Schema (if applicable)
\`\`\`sql
-- Example schema changes
\`\`\`

## Implementation Plan
### Phase 1: Foundation
- [ ] Task 1
- [ ] Task 2

### Phase 2: Core Features
- [ ] Task 1
- [ ] Task 2

### Phase 3: Enhancement
- [ ] Task 1
- [ ] Task 2

## Testing Strategy
### Unit Tests
- What components need unit testing
- Edge cases to test

### Integration Tests
- How components interact
- End-to-end scenarios

### Performance Testing
- Load testing requirements
- Performance benchmarks

## Risk Assessment
| Risk | Impact | Probability | Mitigation |
|------|--------|-------------|------------|
| Technical risk 1 | High/Med/Low | High/Med/Low | How to mitigate |

## Alternative Approaches
### Option 1: [Alternative Name]
**Pros**: 
**Cons**: 
**Decision**: Why not chosen

### Option 2: [Alternative Name]
**Pros**: 
**Cons**: 
**Decision**: Why not chosen

## Dependencies
- External dependencies
- Internal dependencies
- Third-party services

## Success Metrics
- How do we measure success?
- KPIs to track
- Acceptance criteria

## Future Considerations
- Potential extensions
- Scaling considerations
- Technical debt to consider

## Questions & Notes
- Open questions
- Research needed
- Decisions pending

---
*Design document template generated by claude-setup*
EOF

    echo "‚úÖ Created design document: $DESIGN_FILE"
    echo ""
    echo "Next steps:"
    echo "1. Fill out the design document sections"
    echo "2. Review with team/stakeholders"
    echo "3. Use '/design review $FEATURE_NAME' when ready"
    echo "4. Use '/todo' to track implementation tasks"
    ;;
    
  "edit"|"open"|"modify")
    if [ -z "$ARGS" ]; then
      echo "Available design documents:"
      ls .claude/designs/*.md 2>/dev/null | sed 's|.*/||; s|\.md$||; s|^|  |' || echo "  No designs found"
      echo ""
      echo "Usage: /design edit <feature-name>"
      exit 1
    fi
    
    FEATURE_NAME="$ARGS"
    DESIGN_FILE=".claude/designs/${FEATURE_NAME}.md"
    
    if [ ! -f "$DESIGN_FILE" ]; then
      echo "‚ùå Design document not found: $DESIGN_FILE"
      echo "Use '/design new $FEATURE_NAME' to create it"
      exit 1
    fi
    
    echo "üìù Opening design document: $DESIGN_FILE"
    echo "Use your preferred editor to modify the design document."
    echo ""
    echo "Current status:"
    grep "^**Status**:" "$DESIGN_FILE" || echo "Status not found"
    ;;
    
  "review"|"status"|"check")
    if [ -z "$ARGS" ]; then
      echo "üìä Design Review Summary"
      echo "======================="
      
      if [ ! -d ".claude/designs" ] || [ -z "$(ls .claude/designs/*.md 2>/dev/null)" ]; then
        echo "No design documents found"
        echo "Use '/design new <feature-name>' to create your first design"
        exit 0
      fi
      
      echo ""
      for design in .claude/designs/*.md; do
        if [ -f "$design" ]; then
          BASENAME=$(basename "$design" .md)
          STATUS=$(grep "^**Status**:" "$design" | cut -d: -f2 | xargs || echo "Unknown")
          CREATED=$(grep "^**Created**:" "$design" | cut -d: -f2 | xargs || echo "Unknown")
          
          echo "üìÑ $BASENAME"
          echo "   Status: $STATUS"
          echo "   Created: $CREATED"
          
          # Count completed requirements
          TOTAL_REQ=$(grep -c "^- \[ \]" "$design" 2>/dev/null || echo "0")
          DONE_REQ=$(grep -c "^- \[x\]" "$design" 2>/dev/null || echo "0")
          
          if [ "$TOTAL_REQ" -gt 0 ]; then
            echo "   Progress: $DONE_REQ/$TOTAL_REQ requirements completed"
          fi
          echo ""
        fi
      done
    else
      FEATURE_NAME="$ARGS"
      DESIGN_FILE=".claude/designs/${FEATURE_NAME}.md"
      
      if [ ! -f "$DESIGN_FILE" ]; then
        echo "‚ùå Design document not found: $DESIGN_FILE"
        exit 1
      fi
      
      echo "üìã Design Review: $FEATURE_NAME"
      echo "==============================="
      
      # Extract key information
      STATUS=$(grep "^**Status**:" "$DESIGN_FILE" | cut -d: -f2 | xargs || echo "Unknown")
      CREATED=$(grep "^**Created**:" "$DESIGN_FILE" | cut -d: -f2 | xargs || echo "Unknown")
      AUTHOR=$(grep "^**Author**:" "$DESIGN_FILE" | cut -d: -f2 | xargs || echo "Unknown")
      
      echo "Status: $STATUS"
      echo "Created: $CREATED"
      echo "Author: $AUTHOR"
      echo ""
      
      # Count requirements
      TOTAL_REQ=$(grep -c "^- \[ \]" "$DESIGN_FILE" 2>/dev/null || echo "0")
      DONE_REQ=$(grep -c "^- \[x\]" "$DESIGN_FILE" 2>/dev/null || echo "0")
      PENDING_REQ=$((TOTAL_REQ - DONE_REQ))
      
      echo "Requirements Progress:"
      echo "  Completed: $DONE_REQ"
      echo "  Pending: $PENDING_REQ"
      echo "  Total: $TOTAL_REQ"
      
      if [ "$PENDING_REQ" -gt 0 ]; then
        echo ""
        echo "Pending Requirements:"
        grep "^- \[ \]" "$DESIGN_FILE" | head -5 | sed 's/^/  /'
      fi
      
      # Check for open questions
      QUESTIONS_COUNT=$(sed -n '/## Questions & Notes/,/^## /p' "$DESIGN_FILE" | grep -c "^-" 2>/dev/null || echo "0")
      if [ "$QUESTIONS_COUNT" -gt 0 ]; then
        echo ""
        echo "Open Questions: $QUESTIONS_COUNT"
      fi
      
      # Implementation readiness check
      echo ""
      echo "Implementation Readiness:"
      
      # Check if key sections are filled out
      if grep -q "Brief description" "$DESIGN_FILE"; then
        echo "  ‚ùå Overview section needs details"
      else
        echo "  ‚úÖ Overview completed"
      fi
      
      if grep -q "What problem are we solving" "$DESIGN_FILE"; then
        echo "  ‚ùå Problem statement needs details"
      else
        echo "  ‚úÖ Problem statement completed"
      fi
      
      if [ "$DONE_REQ" -eq "$TOTAL_REQ" ] && [ "$TOTAL_REQ" -gt 0 ]; then
        echo "  ‚úÖ All requirements defined"
      else
        echo "  ‚ö†Ô∏è  Requirements need completion"
      fi
    fi
    ;;
    
  "list"|"ls")
    echo "üìÅ Available Design Documents"
    echo "============================="
    
    if [ ! -d ".claude/designs" ] || [ -z "$(ls .claude/designs/*.md 2>/dev/null)" ]; then
      echo "No design documents found"
      echo "Use '/design new <feature-name>' to create your first design"
      exit 0
    fi
    
    for design in .claude/designs/*.md; do
      if [ -f "$design" ]; then
        BASENAME=$(basename "$design" .md)
        STATUS=$(grep "^**Status**:" "$design" | cut -d: -f2 | xargs || echo "Unknown")
        echo "  üìÑ $BASENAME ($STATUS)"
      fi
    done
    echo ""
    echo "Use '/design review <name>' for detailed status"
    echo "Use '/design edit <name>' to modify a design"
    ;;
    
  "template"|"templates")
    echo "üìã Design Templates"
    echo "=================="
    echo ""
    echo "Available templates:"
    echo "  feature   - New feature design (default)"
    echo "  api       - API design template"
    echo "  component - UI component design"
    echo "  refactor  - Refactoring design"
    echo "  migration - Data/system migration"
    echo ""
    echo "Usage: /design new <name> --template <type>"
    echo ""
    echo "Custom templates can be added to .claude/design-templates/"
    ;;
    
  "help"|"-h"|"--help")
    cat << 'EOF'
Design Planning Command Help

USAGE:
  /design [command] [arguments]

COMMANDS:
  new, create, start <name>     Create new design document
  edit, open, modify <name>     Open design document for editing
  review, status, check [name]  Review design status and progress
  list, ls                      List all design documents
  template, templates           Show available design templates
  help                         Show this help

EXAMPLES:
  /design new user-auth        Create design for user authentication
  /design review user-auth     Check progress on user-auth design
  /design list                 See all design documents
  /design edit user-auth       Open design document for editing

WORKFLOW:
  1. Create design: /design new <feature>
  2. Fill out sections in the generated template
  3. Review progress: /design review <feature>
  4. Track implementation with /todo
  5. Update status as you progress

INTEGRATION:
- Designs stored in .claude/designs/
- Templates include requirements tracking
- Links with /todo for implementation tracking
- Supports architectural decision records (ADRs)
EOF
    ;;
    
  "interactive"|"")
    echo "üé® Design Planning Assistant"
    echo "============================"
    echo ""
    echo "What would you like to design?"
    echo ""
    echo "Common options:"
    echo "  1. New feature or component"
    echo "  2. API endpoint or service"
    echo "  3. Database schema change"
    echo "  4. Refactoring plan"
    echo "  5. System architecture"
    echo ""
    echo "Commands:"
    echo "  /design new <name>      Create new design"
    echo "  /design list            See existing designs"
    echo "  /design review          Check design progress"
    echo "  /design help            Full command reference"
    ;;
    
  *)
    echo "‚ùå Unknown design command: $COMMAND"
    echo "Use '/design help' for available commands"
    exit 1
    ;;
esac
```

## Features
- **Template-based Design**: Structured templates for different design types
- **Requirements Tracking**: Checkbox-based requirement tracking
- **Progress Monitoring**: Track completion of design phases
- **Multiple Design Types**: Support for features, APIs, components, refactoring
- **Review Process**: Built-in design review and status checking
- **Integration**: Links with `/todo` for implementation tracking

## Design Document Structure
Each design document includes:
- Problem statement and requirements
- Solution architecture and components
- Implementation plan with phases
- Testing strategy and risk assessment
- Alternative approaches considered
- Dependencies and success metrics