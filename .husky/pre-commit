#!/bin/sh
# Run quality checks before commit
echo "üîç Running pre-commit quality checks..."

# Run linting
npm run lint:check --silent
LINT_EXIT=$?
if [ $LINT_EXIT -ne 0 ]; then
  echo "‚ùå Lint checks failed. Run 'npm run lint:check' for details"
  exit 1
fi

# Run tests
npm run test:check --silent
TEST_EXIT=$?
if [ $TEST_EXIT -ne 0 ]; then
  echo "‚ùå Tests failed. Run 'npm test' for details"
  exit 1
fi

# Check staged files count for atomic commits
STAGED_COUNT=$(git diff --cached --name-only | wc -l)
echo "üìä Staged files: $STAGED_COUNT"

if [ "$STAGED_COUNT" -gt 3 ]; then
  echo "‚ö†Ô∏è  Warning: $STAGED_COUNT files staged (recommended: 1-3 for atomic commits)"
  echo "   Consider splitting into smaller commits"
  
  # Check if we're in an interactive terminal
  if [ -t 0 ]; then
    printf "   Continue anyway? (y/n): "
    read -r REPLY
    echo
    case "$REPLY" in
      [Yy]* ) ;;
      * ) 
        echo "üìù Use 'git reset HEAD <file>' to unstage files"
        exit 1
        ;;
    esac
  else
    echo "   (Non-interactive mode - continuing with $STAGED_COUNT files)"
  fi
fi

echo "‚úÖ All quality checks passed!"